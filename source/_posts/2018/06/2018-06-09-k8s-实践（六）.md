---
title: k8s-实践（六）
tags: [k8s, Docker]
img: https://www.holddie.com/img/20200105160600.png
date: 2018-06-09 21:02:33
categories: k8s
---

在这布满硝烟与瓦砾的乱世之中，没有人能纤尘不染地活着。								——颜未雪



### 集群基本操作

查看集群信息

```shell
kubectl cluster-info
```

### k8s 对象管理

#### 管理技巧

- k8s 对象应该只使用一种技术进行管理，混合使用不同的技术，会导致相同对象出现未定义的行为

| 管理技术       | 操作     | 推荐环境 | 支持撰写 | 学习曲线 |
| -------------- | -------- | -------- | -------- | -------- |
| 命令式的方式   | 活动对象 | 开发项目 | 1+       | 最低     |
| 命令式对象配置 | 单文件   | 生产项目 | 1        | 中等     |
| 声明式对象配置 | 文件目录 | 生产项目 | 1+       | 最高     |

#### 命令式的方式

通过命令的方式直接对集群中的活动对象进行操作，直接在活动的对象上运行，他没有提供以前配置的历史记录。

###### 通过创建 Deployment 对象来运行 Nginx 容器的实例

```shell
$ kubectl run nginx --iamge nginx
```

###### 使用不同的语法做同样的事情

```shell
$ kubectl create deployment nginx --iamge nginx
```

##### 优缺点

- 命令简单，只需一个步骤就可以对集群修改
- 命令不与变更流程整合，不能提供审计追踪
- 不能用于提供创建新对象的模板

#### 命令式对象配置

通过文件方式来定义集群的配置，当然文件的格式可以是YAML或JSON格式

###### 创建对象定义配置文件

```shell
$ kubectl create -f nginx.yaml
```

###### 删除两个配置文件中定义的对象

```shell
$ kubectl delete -f nginx.yaml -f redis.yaml
```

###### 通过复写实时更新配置文件中定义的对象

```shell
$ kubectl replace -f nginx.yaml
```

##### 优缺点：

- 配置文件可以存储在GIT等源码控制系统中
- 对象配置可以与进程继承，有推送和审计追踪
- 提供一个用于创建新对象的模板

#### 声明式对象配置

- 使用声明式对象配置，用户对本地存储的对象配置文件进行操作，但是用户没有定义要对文件执行的操作。

- 通过`kubectl` 自动检测每个对象进行创建、更新和删除操作。
- 可以在目录层级上工作，不同的对象可能需要不同的操作。

###### 处理 `configs` 目录中的所有对象配置文件，创建或修补（patch）活动对象

```shell
$ kubectl apply -f configs/
```

###### 递归处理目录

```shell
$ kubectl apply -R -f configs/ 
```

