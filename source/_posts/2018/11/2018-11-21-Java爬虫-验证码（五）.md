---
title: Javaçˆ¬è™«-éªŒè¯ç ï¼ˆäº”ï¼‰
author: HoldDie
tags: [Java,çˆ¬è™«,éªŒè¯ç ]
top: false
date: 2018-11-21 19:43:41
categories: çˆ¬è™«
---

**å¾€äº‹å¦‚æ·±åŸ‹åœ¨è‚Œè‚¤ä¸‹çš„åˆ€é”‹ï¼Œé”€é­‚èš€éª¨ï¼Œä¸€ç¢°å°±ç—›ã€‚ â€”â€”å®‹ç¥å®—**

## éªŒè¯ç è¯†åˆ«æœåŠ¡

> å¯¹äºéªŒè¯ç çš„è¯†åˆ«ï¼Œå¯¹äºä¼—å¤šè¯†åˆ«æ–¹å¼ï¼Œæ­¤æ–‡é€‚ç”¨äºå­—ç¬¦è§„æ•´ï¼Œé•¿å®½ä¸€è‡´ï¼Œæ ·å¼æ ‡å‡†ï¼Œå¯¹äºæœ‰å¾ˆå¤šéªŒè¯çš„æ–¹å¼ï¼Œæ­¤æ–¹å¼ä¹Ÿæ˜¯ä¸€ç§æ€è·¯ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆä¸Šä»£ç ğŸ§

### 1ã€æ ¸å¿ƒéªŒè¯ç éªŒè¯ä»£ç 

```java
import org.apache.http.client.HttpClient;
import org.apache.http.impl.client.DefaultHttpClient;

import javax.imageio.ImageIO;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.*;
import java.net.URL;
import java.net.URLConnection;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;


/**
 * ä¸€ä¸ªè‡ªåŠ¨è¯†åˆ«éªŒè¯ç çš„ç¨‹åºã€‚è¦æ±‚æ˜¯ç®€å•çš„éªŒè¯ç ï¼Œå›ºå®šå¤§å°ï¼Œå›ºå®šä½ç½®ï¼Œå›ºå®šå­—ä½“ï¼›å­—ä½“çº¯è‰²æœ€å¥½ï¼Œå¦‚ä¸æ˜¯éœ€è¦ä¿®æ”¹ä»£ç ã€‚
 * @author HoldDie
 * @version v1.0.0
 * @email HoldDie@163.com
 * @date 2018/11/22 6:22 PM
 */
public class ImageProcess {

    // BASE_PATH
    public static final String BASE_PATH = "/Users/holddie/Desktop/";

    // å­˜æ”¾æ‰€æœ‰ä¸‹è½½éªŒè¯ç çš„ç›®å½•
    private static final String DOWNLOAD_DIR = BASE_PATH + "download";

    // å­˜æ”¾å·²ç»æ‹†åˆ†å¼€çš„å•ä¸ªæ•°å­—å›¾ç‰‡çš„ç›®å½•ï¼Œä¾›æ¯”å¯¹ç”¨
    private static final String TRAIN_DIR = BASE_PATH + "train";

    // å­˜æ”¾æ¯”å¯¹ç»“æœçš„ç›®å½•ï¼ˆé‡æ–°ä»¥éªŒè¯ç æ‰€å«æ•°å­—å‘½åæ–‡ä»¶ï¼Œéå¸¸ç›´è§‚ï¼‰
    private static final String RESULT_DIR = BASE_PATH + "result";

    // å­˜æ”¾æ¯”å¯¹å›¾ç‰‡ä¸ä»£è¡¨æ•°å­—çš„Map
    private static Map<BufferedImage, String> trainMap = new HashMap<BufferedImage, String>();

    // å›¾ç‰‡è¿‡æ»¤å™¨ï¼Œæƒ³è¦ä»€ä¹ˆæ ·çš„å›¾ç‰‡ï¼Œä¼ è¿›åç§°å³å¯ã€‚å¦‚ï¼špng/gif/.png
    static class ImageFileFilter implements FileFilter {
        private String postfix = ".png";

        public ImageFileFilter(String postfix) {
            if (!postfix.startsWith("."))
                postfix = "." + postfix;

            this.postfix = postfix;
        }

        @Override
        public boolean accept(File pathname) {
            return pathname.getName().toLowerCase().endsWith(postfix);
        }
    }

    static {
        try {
            // å°†TRAIN_DIRç›®å½•çš„ä¾›æ¯”å¯¹çš„å›¾ç‰‡è£…è½½è¿›æ¥
            File dir = new File(TRAIN_DIR);
            File[] files = dir.listFiles(new ImageFileFilter("png"));
            for (File file : files) {
                trainMap.put(ImageIO.read(file), file.getName().charAt(0) + "");
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    // 1.ä¸‹è½½éªŒè¯ç ï¼šå°†å¤šä¸ªéªŒè¯ç å›¾ç‰‡ä¸‹è½½åˆ°æŒ‡å®šç›®å½•ï¼Œè¦æ±‚å„ç§å¯èƒ½çš„éªŒè¯ç ï¼ˆå•ä¸ªæ•°å­—ï¼‰éƒ½åº”è¯¥æœ‰ï¼Œæ¯”å¦‚ï¼š0-9ã€‚
    private void downloadImage() throws Exception {
        HttpClient httpClient = new DefaultHttpClient();
        for (int i = 0; i < 10; i++) {
            String url = "http://www.sufengtech.cn/admin/showcaptcha?1542787128202";
            // æ„é€ URL
            URL url1 = new URL(url);
            // æ‰“å¼€è¿æ¥
            URLConnection con = url1.openConnection();
            // è®¾ç½®è¯·æ±‚è¶…æ—¶ä¸º5s
            con.setConnectTimeout(5 * 1000);
            // è¾“å…¥æµ
            InputStream is = con.getInputStream();
            // 1Kçš„æ•°æ®ç¼“å†²
            byte[] bs = new byte[2048];
            // è¯»å–åˆ°çš„æ•°æ®é•¿åº¦
            int len;
            // è¾“å‡ºçš„æ–‡ä»¶æµ
            OutputStream os = new FileOutputStream(new File(DOWNLOAD_DIR, i + ".png"));
            // å¼€å§‹è¯»å–
            while ((len = is.read(bs)) != -1) {
                os.write(bs, 0, len);
            }
        }

        System.out.println("ä¸‹è½½éªŒè¯ç å®Œæ¯•ï¼");
    }

    // 2.å»é™¤å›¾åƒå¹²æ‰°åƒç´ ï¼ˆéå¿…é¡»æ“ä½œï¼Œåªæ˜¯å¯ä»¥æé«˜ç²¾åº¦è€Œå·²ï¼‰ã€‚
    public static BufferedImage removeInterference(BufferedImage image)
            throws Exception {
        int width = image.getWidth();
        int height = image.getHeight();
        for (int x = 0; x < width; ++x) {
            for (int y = 0; y < height; ++y) {
                if (isFontColor(image.getRGB(x, y))) {
                    // å¦‚æœå½“å‰åƒç´ æ˜¯å­—ä½“è‰²ï¼Œåˆ™æ£€æŸ¥å‘¨è¾¹æ˜¯å¦éƒ½ä¸ºç™½è‰²ï¼Œå¦‚éƒ½æ˜¯åˆ™åˆ é™¤æœ¬åƒç´ ã€‚
                    int roundWhiteCount = 0;
                    if (isWhiteColor(image, x + 1, y + 1))
                        roundWhiteCount++;
                    if (isWhiteColor(image, x + 1, y - 1))
                        roundWhiteCount++;
                    if (isWhiteColor(image, x - 1, y + 1))
                        roundWhiteCount++;
                    if (isWhiteColor(image, x - 1, y - 1))
                        roundWhiteCount++;
                    if (roundWhiteCount == 4) {
                        image.setRGB(x, y, Color.WHITE.getRGB());
                    }
                }
            }
        }
        return image;
    }

    // å–å¾—æŒ‡å®šä½ç½®çš„é¢œè‰²æ˜¯å¦ä¸ºç™½è‰²ï¼Œå¦‚æœè¶…å‡ºè¾¹ç•Œï¼Œè¿”å›true
    // æœ¬æ–¹æ³•æ˜¯ä»removeInterferenceæ–¹æ³•ä¸­æ‘˜å–å‡ºæ¥çš„ã€‚å•ç‹¬è°ƒç”¨æœ¬æ–¹æ³•æ— æ„ä¹‰ã€‚
    private static boolean isWhiteColor(BufferedImage image, int x, int y) throws Exception {
        if (x < 0 || y < 0) return true;
        if (x >= image.getWidth() || y >= image.getHeight()) return true;

        Color color = new Color(image.getRGB(x, y));

        return color.equals(Color.WHITE) ? true : false;
    }

    // 3.åˆ¤æ–­æ‹†åˆ†éªŒè¯ç çš„æ ‡å‡†ï¼šå°±æ˜¯å®šä¹‰éªŒè¯ç ä¸­åŒ…å«çš„å„æ•°å­—çš„xã€yåæ ‡å€¼ï¼ŒåŠå®ƒä»¬çš„å®½åº¦ï¼ˆwidthï¼‰ã€é«˜åº¦ï¼ˆheightï¼‰ã€‚
    private static List<BufferedImage> splitImage(BufferedImage image) throws Exception {
        final int DIGIT_WIDTH = 15;
        final int DIGIT_HEIGHT = 18;

        List<BufferedImage> digitImageList = new ArrayList<BufferedImage>();
        digitImageList.add(image.getSubimage(5, 7, DIGIT_WIDTH, DIGIT_HEIGHT));
        digitImageList.add(image.getSubimage(20, 7, DIGIT_WIDTH, DIGIT_HEIGHT));
        digitImageList.add(image.getSubimage(35, 7, DIGIT_WIDTH, DIGIT_HEIGHT));
        digitImageList.add(image.getSubimage(50, 7, DIGIT_WIDTH, DIGIT_HEIGHT));
        return digitImageList;
    }

    // 4.åˆ¤æ–­å­—ä½“çš„é¢œè‰²å«ä¹‰ï¼šæ­£å¸¸å¯ä»¥ç”¨rgbä¸‰ç§é¢œè‰²åŠ èµ·æ¥è¡¨ç¤ºï¼Œå­—ä¸éå­—åº”è¯¥æœ‰æ˜¾ç¤ºçš„åŒºåˆ«ï¼Œæ‰¾å‡ºæ¥ã€‚
    private static boolean isFontColor(int colorInt) {
        Color color = new Color(colorInt);
        return color.getRed() + color.getGreen() + color.getBlue() < 10;
    }


    // 5.å°†ä¸‹è½½çš„éªŒè¯ç å›¾ç‰‡å…¨éƒ¨æ‹†åˆ†åˆ°å¦ä¸€ä¸ªç›®å½•ã€‚
    public void generateStdDigitImgage() throws Exception {
        File dir = new File(DOWNLOAD_DIR);
        File[] files = dir.listFiles(new ImageFileFilter("png"));

        int counter = 0;
        for (File file : files) {
            BufferedImage image = ImageIO.read(file);
            removeInterference(image);
            List<BufferedImage> digitImageList = splitImage(image);
            for (int i = 0; i < digitImageList.size(); i++) {
                BufferedImage bi = digitImageList.get(i);
                ImageIO.write(bi, "PNG", new File(TRAIN_DIR, "temp_" + counter++ + ".png"));
            }
        }
        System.out.println("ç”Ÿæˆä¾›æ¯”å¯¹çš„å›¾ç‰‡å®Œæ¯•ï¼Œè¯·åˆ°ç›®å½•ä¸­æ‰‹å·¥è¯†åˆ«å¹¶é‡å‘½åå›¾ç‰‡ï¼Œå¹¶åˆ é™¤å…¶å®ƒæ— å…³å›¾ç‰‡ï¼");
    }


    // 7.æµ‹è¯•åˆ¤æ–­æ•ˆæœï¼šè¿è¡Œæ–¹æ³•ï¼Œå¯ä»¥è°ƒæ•´rgbä¸‰å€¼ï¼Œä»¥è¾¾åˆ°é«˜çš„åˆ†è¾¨ç‡ã€‚
    // ç›®å‰æ­¤æ–¹æ³•æä¾›åœ¨è¾“å‡ºåˆ¤æ–­ç»“æœçš„åŒæ—¶ï¼Œåœ¨ç›®æ ‡ç›®å½•ç”Ÿæˆä»¥åˆ¤æ–­ç»“æœå‘½åçš„æ–°éªŒè¯ç å›¾ç‰‡ï¼Œä»¥æ‰¹é‡æ£€æŸ¥æ•ˆæœã€‚
    public void testDownloadImage() throws Exception {
        File dir = new File(DOWNLOAD_DIR);
        File[] files = dir.listFiles(new ImageFileFilter("png"));

        for (File file : files) {
            String validateCode = getValidateCode(file);
            System.out.println(file.getName() + "=" + validateCode);
        }

        System.out.println("åˆ¤æ–­å®Œæ¯•ï¼Œè¯·åˆ°ç›¸å…³ç›®å½•æ£€æŸ¥æ•ˆæœï¼");
    }

    /**
     * 8.æä¾›ç»™å¤–ç•Œæ¥å£è°ƒç”¨ã€‚
     * @param file
     * @return
     * @exception Exception
     */
    public static String getValidateCode(File file) throws Exception {
        // è£…è½½å›¾ç‰‡
        BufferedImage image = ImageIO.read(file);
        removeInterference(image);
        // æ‹†åˆ†å›¾ç‰‡
        List<BufferedImage> digitImageList = splitImage(image);

        // å¾ªç¯æ¯ä¸€ä½æ•°å­—å›¾è¿›è¡Œæ¯”å¯¹
        StringBuilder sb = new StringBuilder();
        for (BufferedImage digitImage : digitImageList) {
            String result = "";
            int width = digitImage.getWidth();
            int height = digitImage.getHeight();

            // æœ€å°çš„ä¸åŒæ¬¡æ•°ï¼ˆåˆå§‹å€¼ä¸ºæ€»åƒç´ ï¼‰ï¼Œå€¼è¶Šå°å°±è¶Šåƒã€‚
            int minDiffCount = width * height;
            for (BufferedImage bi : trainMap.keySet()) {
                // å¯¹æ¯ä¸€ä½æ•°å­—å›¾ä¸å­—å…¸ä¸­çš„è¿›è¡ŒæŒ‰åƒç´ æ¯”è¾ƒ
                int currDiffCount = 0; // æŒ‰åƒç´ æ¯”è¾ƒä¸åŒçš„æ¬¡æ•°
                outer:
                for (int x = 0; x < width; ++x) {
                    for (int y = 0; y < height; ++y) {
                        if (isFontColor(digitImage.getRGB(x, y)) != isFontColor(bi.getRGB(x, y))) {
                            // æŒ‰åƒç´ æ¯”è¾ƒå¦‚æœä¸åŒï¼Œåˆ™åŠ 1ï¼›
                            currDiffCount++;
                            // å¦‚æœå€¼å¤§äºminDiffCountï¼Œåˆ™ä¸ç”¨å†æ¯”è¾ƒäº†ï¼Œå› ä¸ºæˆ‘ä»¬è¦æ‰¾æœ€å°çš„minDiffCountã€‚
                            if (currDiffCount >= minDiffCount)
                                break outer;
                        }
                    }
                }
                if (currDiffCount < minDiffCount) {
                    // ç°åœ¨è°å·®åˆ«æœ€å°ï¼Œå°±å…ˆæš‚æ—¶æŠŠå€¼èµ‹äºˆç»™å®ƒ
                    minDiffCount = currDiffCount;
                    result = trainMap.get(bi);
                }
            }
            sb.append(result);
        }
        ImageIO.write(image, "PNG", new File(RESULT_DIR, sb.toString() + ".png"));

        return sb.toString();
    }

    public static void main(String[] args) throws Exception {
        ImageProcess ins = new ImageProcess();

        // ç¬¬1æ­¥ï¼Œä¸‹è½½éªŒè¯ç åˆ°DOWNLOAD_DIR
        ins.downloadImage();

        // ç¬¬2æ­¥ï¼Œå»é™¤å¹²æ‰°çš„åƒç´ 
        File dir = new File(DOWNLOAD_DIR);
        File[] files = dir.listFiles(new ImageFileFilter("png"));
        assert files != null;
        for (File file : files) {
            BufferedImage image = ImageIO.read(file);
            removeInterference(image);
            ImageIO.write(image, "PNG", file);
            System.out.println("æˆåŠŸå¤„ç†ï¼š" + file.getName());
        }

        // ç¬¬3æ­¥ï¼Œåˆ¤æ–­æ‹†åˆ†éªŒè¯ç çš„æ ‡å‡†
        // é€šè¿‡PhotoShopæ‰“å¼€éªŒè¯ç å¹¶æ”¾å¤§è§‚å¯Ÿï¼Œæˆ‘è¿™å„¿çš„ç»“æœå‚è€ƒsplitImage()æ–¹æ³•ä¸­çš„å˜é‡

        // ç¬¬4æ­¥ï¼Œåˆ¤æ–­å­—ä½“çš„é¢œè‰²å«ä¹‰
        // é€šè¿‡PhotoShopæ‰“å¼€éªŒè¯ç å¹¶æ”¾å¤§è§‚å¯Ÿï¼Œæˆ‘è¿™å„¿å­—ä½“é¢œè‰²çš„rgbæ€»å€¼åŠ èµ·æ¥åœ¨340ã€‚å› ä¸ºæ˜¯çº¯è‰²ã€‚

        // ç¬¬5æ­¥ï¼Œå°†ä¸‹è½½çš„éªŒè¯ç å›¾ç‰‡å…¨éƒ¨æ‹†åˆ†åˆ°TRAIN_DIRç›®å½•ã€‚
        ins.generateStdDigitImgage();

        // ç¬¬6æ­¥ï¼Œæ‰‹å·¥å‘½åæ–‡ä»¶
        // æ‰“å¼€èµ„æºç®¡ç†å™¨ï¼Œé€‰æ‹©TRAIN_DIRï¼Œåˆ†åˆ«æ‰¾å‡ºæ˜¾ç¤º0-9æ•°å­—çš„æ–‡ä»¶ï¼Œä»¥å®ƒçš„åå­—é‡æ–°å‘½åï¼Œåˆ é™¤å…¶å®ƒæ‰€æœ‰çš„ã€‚

        // ç¬¬7æ­¥ï¼Œæµ‹è¯•åˆ¤æ–­æ•ˆæœï¼Œè¿è¡Œåæ‰“å¼€RESULT_DIRï¼Œæ£€æŸ¥æ–‡ä»¶åæ˜¯å¦ä¸éªŒè¯ç å†…å®¹ä¸€è‡´ã€‚
        ins.testDownloadImage();

        // ç¬¬8æ­¥ï¼Œæä¾›ç»™å¤–ç•Œæ¥å£è°ƒç”¨ã€‚
        String validateCode = com.xiaohuazhu.spider.core.core.utils.ImageProcess.getValidateCode(new File(DOWNLOAD_DIR, "2.png"));
        System.out.println("éªŒè¯ç ä¸ºï¼š" + validateCode);

    }
}
```

### 2ã€Selenium ä»£ç 

```java
import com.baidu.aip.ocr.AipOcr;
import com.xiaohuazhu.spider.core.core.utils.File2byteUtil;
import com.xiaohuazhu.spider.core.core.utils.ImageProcess;
import org.openqa.selenium.By;
import org.openqa.selenium.Cookie;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.chrome.ChromeOptions;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;
import us.codecraft.webmagic.Page;
import us.codecraft.webmagic.Request;
import us.codecraft.webmagic.Site;
import us.codecraft.webmagic.Spider;
import us.codecraft.webmagic.pipeline.ConsolePipeline;
import us.codecraft.webmagic.processor.PageProcessor;
import us.codecraft.webmagic.utils.HttpConstant;

import java.io.IOException;
import java.util.Set;
import java.util.concurrent.TimeUnit;

import static com.xiaohuazhu.spider.core.core.utils.ImageProcess.DOWNLOAD_DIR;

@Component
public class DemoPageProcessor implements PageProcessor {
    //é…ç½®æŠ“å–æ—¶é—´ã€é‡è¯•æ¬¡æ•°ç­‰
    private Site site = Site.me().setRetryTimes(5).setTimeOut(3000).setSleepTime(1000);

    //ç”¨æ¥å­˜å‚¨cookieä¿¡æ¯
    private Set<Cookie> cookies;

    @Autowired
    private AipOcr aipOcr;

    @Override
    public void process(Page page) {
        //è®¾ç½®POSTè¯·æ±‚
        Request request = new Request("http://172.24.30.137/wallinfo/queryList.xhtml?ids=&datas=&street=&createtimeBegin=&createtimeEnd=&busst=&maiindustry=&page=1&rows=10000");
        //åªæœ‰POSTè¯·æ±‚æ‰å¯ä»¥æ·»åŠ é™„åŠ å‚æ•°
        request.setMethod(HttpConstant.Method.POST);
        // å¼€å§‹æ‰§è¡Œ
        try {
//            Spider.create(new kaiqiangdadongDataPageProcessor()).addRequest(request).addPipeline(new kaiqiangdadongDataPipeline()).addPipeline(new ConsolePipeline()).thread(5).run();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }


    //ä½¿ç”¨ Selenium æ¥æ¨¡æ‹Ÿç”¨æˆ·çš„ç™»å½•è·å–cookieä¿¡æ¯
    public void login() throws InterruptedException, IOException {

        //è®¾ç½®é©±åŠ¨ç¨‹åºè·¯å¾„
        //Chrome
        System.setProperty("webdriver.chrome.driver", "/Users/holddie/worktools/phantomjs/bin/chromedriver");
        ChromeOptions options = new ChromeOptions();
        //å…¨å±
//        options.addArguments("start-fullscreen");
//        options.addArguments("--start-maximized");
        //ç¦æ­¢å¼¹å‡ºæ‹¦æˆª
        options.addArguments("--disable-popup-blocking");
        //å–æ¶ˆæ²™ç›˜æ¨¡å¼
        options.addArguments("no-sandbox");
        //ç¦æ­¢æ‰©å±•
        options.addArguments("disable-extensions");
        //ç¦æ­¢é»˜è®¤æµè§ˆå™¨æ£€æŸ¥
        options.addArguments("no-default-browser-check");
        options.addArguments("about:histograms");
        options.addArguments("about:cache");
        //è®¾ç½®æµè§ˆå™¨å›ºå®šå¤§å°
        options.addArguments("--window-size=1204.3,677.4");
        // chromeæ­£å—åˆ°è‡ªåŠ¨æµ‹è¯•è½¯ä»¶çš„æ§åˆ¶
        options.addArguments("disable-infobars");

        WebDriver driver = new ChromeDriver(options);
        // è®¾ç½®æµè§ˆå™¨çš„ä½ç½®ï¼š
        // æ³¨æ„ï¼šè®¾å®šäº†æµè§ˆå™¨å›ºå®šå¤§å°åï¼Œæµè§ˆå™¨æ‰“å¼€åæµè§ˆå™¨çš„ä½ç½®å¯èƒ½ä¼šå˜åˆ°å…¶ä»–ä½ç½®ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨è®¾ç½®åˆ˜æµè§ˆå™¨çš„ä½ç½®æ–¹æ³•å’Œè®¾ç½®æµè§ˆå™¨çš„å¤§å°æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼›
//        Point point=new Point(0,0);
//        driver.manage().window().setPosition(point);
        // å±å¹•æœ€å¤§åŒ–
//        driver.manage().window().maximize();
        // è®¾ç½®è·å–é¡µé¢å…ƒç´ çš„æœ€å¤§ç­‰å¾…æ—¶é—´
        driver.manage().timeouts().implicitlyWait(20, TimeUnit.SECONDS);

        //ç™»é™†åœ°å€
        driver.get("http://www.xxx.cn/admin/index");

        //å¯»æ‰¾è´¦å·ç¼–è¾‘æ¡†
        driver.findElement(By.id("loginname")).clear();
        driver.findElement(By.id("loginname")).sendKeys("000100");

        //å¯»æ‰¾å¯†ç ç¼–è¾‘æ¡†
        driver.findElement(By.id("password")).clear();
        driver.findElement(By.id("password")).sendKeys("0E95bY5w");

//        //åˆ›å»ºä¸€ä¸ªæ—¶é—´æˆ³,é˜²æ­¢éªŒè¯ç å›¾ç‰‡æ–‡ä»¶é‡å
//        String timestamp = System.currentTimeMillis() + "";
//
//        //å¯»æ‰¾éªŒè¯ç å®¹å™¨
//        WebElement ele = driver.findElement(By.className("huoqu"));
//
//        //åˆ›å»ºä¸€ä¸ªå¿«ç…§
//        File screenshot = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
//
//        //è¯»å–æˆªå›¾
//        BufferedImage fullImg = ImageIO.read(screenshot);
//
//        //è·å–é¡µé¢ä¸Šå…ƒç´ çš„ä½ç½®
//        org.openqa.selenium.Point point = ele.getLocation();
//
//        //è·å–å…ƒç´ å®½é«˜
//        int eleWidth = ele.getSize().getWidth();
//        int eleHeight = ele.getSize().getHeight();
//
//        //è£å‰ªæ•´ä¸ªé¡µé¢æˆªå›¾åªå¾—åˆ°å…ƒç´ æˆªå›¾
//        BufferedImage eleScreenshot = fullImg.getSubimage(point.getX(), point.getY(), eleWidth, eleHeight);
//        ImageIO.write(eleScreenshot, "png", screenshot);
//
//
//        //å°†éªŒè¯ç æˆªå›¾ä¿å­˜åˆ°æœ¬åœ°
//        File screenshotLocation = new File(DOWNLOAD_DIR, "0.png");
//        FileUtils.copyFile(screenshot, screenshotLocation);

        ImageProcess.downloadImage(DOWNLOAD_DIR, driver.manage().getCookies().toString());

        // ä¿®æ­£å›¾ç‰‡çš„å¤§å° 93 40-> 70 30
//        File2byteUtil.resizeImage(DOWNLOAD_DIR + "/0.png", DOWNLOAD_DIR + "/0.png", 70);
        ImageProcess.remove();

        //å®šä¹‰éªŒè¯ç å˜é‡
        String verify = ImageProcess.getValidateCode();

        //å¯»æ‰¾éªŒè¯ç ç¼–è¾‘æ¡†
        driver.findElement(By.id("captcha")).clear();
        driver.findElement(By.id("captcha")).sendKeys(verify);

        //æ¨¡æ‹Ÿç‚¹å‡»ç™»å½•æŒ‰é’®
        driver.findElement(By.id("btnLogin")).click();

        //è·å–cookieä¿¡æ¯
        cookies = driver.manage().getCookies();
        System.out.printf(cookies.toString());
        //driver.close();
    }

    @Override
    public Site getSite() {
        //å°†è·å–åˆ°çš„cookieä¿¡æ¯æ·»åŠ åˆ°webmagicä¸­
        for (Cookie cookie : cookies) {
            site.addCookie(cookie.getName().toString(), cookie.getValue().toString());
        }

        return site.addHeader("User-Agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit / 537.36 (KHTML, like Gecko)Chrome / 67.0 .3396 .99 Safari / 537.36 ");
    }

    public static void main(String[] args) throws InterruptedException, IOException {
        DemoPageProcessor dpp = new DemoPageProcessor();

        //è°ƒç”¨seleniumï¼Œè¿›è¡Œæ¨¡æ‹Ÿç™»å½•
        dpp.login();

        // å¼€å§‹æ‰§è¡Œ
        try {
            Spider.create(new DemoPageProcessor()).addUrl("xxx").addPipeline(new ConsolePipeline()).thread(5).run();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

}
```

### å‚è€ƒé“¾æ¥

> - [åŸºäº Java çš„ OCR éªŒè¯ç è¯†åˆ« (éªŒè¯ç ä½ç½®ä¸å®šã€å¤§å°å½¢çŠ¶ä¸å˜)]: http://www.lyceum.cc/java-ocr-verification-code-identification/302/
>
> - [webmagicæ˜¯ä¸ªç¥å¥‡çš„çˆ¬è™«ã€ä¸‰ã€‘â€”â€” ä½¿ç”¨seleniumæ¨¡æ‹Ÿç™»é™†]: https://blog.csdn.net/qixinbruce/article/details/71105444
>
> - [Javaå¦‚ä½•è·å–å›¾ç‰‡éªŒè¯ç ä¿å­˜]: https://www.cnblogs.com/Shanghai-vame/p/9032868.html
>
> - [javaéªŒè¯ç è¯†åˆ«â€“4]: https://blog.csdn.net/problc/article/details/5846614
>
> - [Javaè¯†åˆ«éªŒè¯ç å’Œå›¾åƒå¤„ç†]: https://blog.csdn.net/zhulier1124/article/details/80606647
>
> - [Javaä¸¨éªŒè¯ç å›¾ç‰‡å»é™¤å¹²æ‰°åƒç´ ï¼Œæ–¹ä¾¿éªŒè¯ç çš„è¯†åˆ«]: https://www.cnblogs.com/haojieli/p/6212627.html
>
> - [java selenium tess4jè¯†åˆ«éªŒè¯ç æ¨¡æ‹Ÿç™»é™†ã€‚]: https://blog.csdn.net/u013166622/article/details/78156700
>
> - [Javaå®ç°è¶…ç®€å•éªŒè¯ç è¯†åˆ«]: https://blog.csdn.net/bingjianIT/article/details/80637187
>
> - [Javaç®€å•éªŒè¯ç è¯†åˆ«ï¼ˆé™„æºç ï¼‰]: https://blog.csdn.net/q651742112/article/details/76405504
>
> - [Javaç®€å•éªŒè¯ç çš„è¯†åˆ«]: https://www.cnblogs.com/nayitian/p/3282862.html