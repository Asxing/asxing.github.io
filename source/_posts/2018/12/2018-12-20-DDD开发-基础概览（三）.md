---
title: DDD开发-基础概览（三）
author: HoldDie
tags: [DDD]
top: false
date: 2018-12-20 19:43:41
categories: DDD
---

**天地之间的无形之力，也在无形之中改变着天地。 ——浮歌**

### DDD概述

#### 理解

- DDD是针对复杂系统设计的一套软件工程方法
- 领域驱动设计是一个开放的设计方法体系
- 微服务是一种架构风格
- 一个复杂系统由多个微服务组成
- 每个微服务之间松耦合,各自完成自己的任务
- 两者之间的关系: **领域驱动设计中限界上下文与微服务之间的映射关系**

#### 发展趋势

- 以函数式变成思想为基础的领域建模理念与事件驱动架构和响应式编程的结合,可能在低延迟高并发的项目中发挥作用
- DDD 设计为基础的框架,让微服务设计和领域建模更加容易
- 不同的业务场景可以选择更合适的DDD实践

#### 战略设计阶段 战术设计阶段

- 限界上下文, 上下文映射, 分层架构
- 前者更偏向于架构
- 后者偏向于设计与编码

主要是分析问题域,**学会对设计的本质思考，不要只限于对设计概念的掌握，而要追求对设计原则与方法的融汇贯通**

#### DDD做的事情

- 改变了传统软件开发工程师对数据库进行的建模方法
- 将要解决的业务概念和业务规则转换为软件系统中的类型以及类型的属性和行为
- 通过合理运用面向对象的封装、继承和多态等设计要素，降低或隐藏了整个系统的业务复杂性
- 使系统更好的扩展性，应对缤纷多变的实现业务问题
- 领域驱动设计师设计观念的转变，蕴含了全新的设计思想、设计原则和设计过程。
- 以领域为核心驱动
- 领域驱动设计贯穿了整个软件开发的生命周期，包括对需求的分析、建模、架构、设计，甚至最终的编码实现，乃至对编码的测试与重构。
- 领域驱动设计强调领域模型的重要性，并通过模型驱动设计来保障领域模型与程序设计的一致。
- 从业务需求中提炼出统一语言（Ubiquitous Language），再基于统一语言建立领域模型；这个领域模型会指导着程序设计以及编码实现；最后，又通过重构来发现隐式概念，并运用设计模式改进设计与开发质量。

### 战略设计阶段

#### 问题域方面：

- 针对问题域，引入 限界上下文（Bounded Context）和上下文映射（Context Map）对问题域进行合理的分界，识别出核心领域（Core Domain）与 子领域（SubDomain）
- 确定领域的边界以及他们之间的关系，维持模型的完整性

#### 架构方面

- 通过分层架构来隔离关注点，尤其是将领域实现独立出来，能够更利于领域模型的单一性和稳定性
- 引入六边形架构可以清晰地表达领域与技术基础设施的边界
- CQRS 模式则分离了查询场景和命令场景，针对不同的场景选择使用同步或异步操作，来提高架构的低延迟性与高并发能力

### 战术设计阶段

#### 领域模型主要元素：

- 值对象（Value Object）
- 实体（Entity）
- 领域服务（Domain Service）
- 领域时间（Domain Event）
- 资源库（Repository）
- 工厂（Factory）
- 聚合（Aggregation）
- 应用服务（Application Service）

#### 诸要素之间的关系

- 领域驱动设计围绕着领域模型进行设计，通过分层架构（Layered Architecture）将领域独立出来。
- 表示领域模型的对象包括：实体、值对象、领域服务，领域逻辑都应该封装在这些对象中
- 这样可以避免业务逻辑渗透到领域层之外，导致技术实现与业务逻辑的混淆。
- 聚合是一种边界，可以封装一到多个实体与值对象，并维持边界范围之内的业务完整性。
- 在聚合中，至少包含一个实体，只有实体才能作为聚合根（Aggregation Root）
- 领域驱动设计中，没有任何一个类是单独的聚合，应为聚合代表是边界的概念，而非领域概念。
- 在极端情况下一个聚合可能有且只有一个实体。
- 工厂：负责领域对象的创建，用于封装复杂或者可能变化的创建逻辑
- 资源库：负责存放资源的位置（数据库、内存、Web资源）获取、添加、删除或者修改领域对象。
- 领域模型中的资源库不应该暴露访问领域对象的技术实现细节。

#### 演进的领域驱动设计过程

- 战略设计会控制和分界战术设计的边界与粒度，战术设计则以证实角度验证领域模型的有效性、完整性和一致性。
- 进而以演进的方式对之前的战略设计阶段进行迭代，形成螺旋上升设计的过程。

面对客户的业务需求，由领域专家与开发团队展开充分的交流，经过需求分析与知识提炼，以获得清晰的问题域。通过对问题域进行分析和建模，识别限界上下文，利用它划分相对独立的领域，再通过上下文映射建立它们之间的关系，辅以分层架构与六边形架构划分系统的逻辑边界与物理边界，界定领域与技术之间的界限。之后，进入战术设计阶段，深入到限界上下文内对领域进行建模，并以领域模型指导程序设计与编码实现。若在实现过程中，发现领域模型存在重复、错位或缺失时，再进而对已有模型进行重构，甚至重新划分限界上下文。

两个不同阶段的设计目标是保持一致的，它们是一个连贯的过程，彼此之间又相互指导与规范，并最终保证**一个有效的领域模型和一个富有表达力的实现同时演进**。